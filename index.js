import{DAppActions}from"auro-web3-provider";let account;const initializeMina=async()=>{const e=document.getElementById("connectButton"),n=document.getElementById("getAccounts"),t=document.getElementById("getAccountsResult");e.onclick=async()=>{if(window.mina){e.innerText="Onboarding in progress";let n=await window.mina.requestAccounts().catch((e=>e));if(n.message)e.innerText=n.message;else{let t=n;account=t,document.getElementById("accounts").innerHTML=t,e.innerText="Connected",e.disabled=!0}}else alert("No provider was found 请先安装 Auro Wallet")},n.onclick=async()=>{if(window.mina){let e=await window.mina.requestAccounts().catch((e=>e)),n=e;e.message?t.innerHTML=e.message:t.innerHTML=n}};const a=document.getElementById("sendButton"),i=document.getElementById("sendAmountInput"),s=document.getElementById("receiveAddressInput"),o=document.getElementById("sendFee"),c=document.getElementById("sendMemo"),d=document.getElementById("sendResultDisplay");a.onclick=async()=>{let e=await window.mina.request({method:DAppActions.mina_sendPayment,params:{amount:i.value,to:s.value,fee:o.value,memo:c.value}}).catch((e=>e));e.hash?d.innerHTML=e.hash:d.innerHTML=e.message};const m=document.getElementById("stakingButton"),u=document.getElementById("vaildatorAddressInput"),l=document.getElementById("stakeFee"),g=document.getElementById("stakeMemo"),r=document.getElementById("stakingResultDisplay");m.onclick=async()=>{let e=await window.mina.request({method:DAppActions.mina_sendStakeDelegation,params:{to:u.value,fee:l.value,memo:g.value}}).catch((e=>e));e.hash?r.innerHTML=e.hash:r.innerHTML=e.message};const y=document.getElementById("signMessageButton"),w=document.getElementById("signMessageContent"),B=document.getElementById("signMessageResult"),I=document.getElementById("signVerifyButton"),h=document.getElementById("verifyResult");let E;y.onclick=async()=>{E=await window.mina.request({method:DAppActions.mina_signMessage,params:{message:w.value}}).catch((e=>e)),console.log("signResult===0",E),E.signature?B.innerHTML=JSON.stringify(E.signature):B.innerHTML=E.message},I.onclick=async()=>{let e={publicKey:account&&account.length>0?account[0]:"",signature:{field:E?.signature?.field,scalar:E?.signature?.scalar},payload:w.value},n=await window.mina.verifyMessage(e).catch((e=>e));h.innerHTML=n},setTimeout((async()=>{window.mina&&(window.mina.on("accountsChanged",A),window.mina.on("chainChanged",M),M(await window.mina.requestNetwork().catch((e=>e))))}),200);const p=document.getElementById("network");function M(e){p.innerHTML=e}function A(n){Array.isArray(n)&&(document.getElementById("accounts").innerHTML=n,0===n.length&&(e.innerText="Connect",e.disabled=!1))}};window.addEventListener("DOMContentLoaded",initializeMina);